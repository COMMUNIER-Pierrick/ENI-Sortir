{% extends 'base.html.twig' %}

{% block body %}
    <h2>Créer une sortie</h2>
    <div>
        {{ form_start(sortieForm) }}
        {# {{ form_widget(sortieForm) }} #}
        {{ form_errors(sortieForm) }}
        <div class="group">
            {{ form_row(sortieForm.nom) }}
            {{ form_row(sortieForm.dateHeureDebut) }}
            {{ form_row(sortieForm.dateLimiteInscription) }}
            {{ form_row(sortieForm.nbInscriptionsMax) }}
            {{ form_row(sortieForm.duree) }}
            {{ form_row(sortieForm.infosSortie) }}
        </div>
        <br>
        <br>

        <div class="group">
            {{ form_row(sortieForm.campus) }}
            {{ form_row(sortieForm.ville) }}
            {{ form_rest(sortieForm) }}
            <p><span>Rue: </span><span id="rue"></span></p>
            <p><span>Code Postal: </span><span id="codePostal"></span></p>
            <p><span>Latitude: </span><span id="latitude"></span></p>
            <p><span>Longitude: </span><span id="longitude"></span></p>
            <input type="submit" name="create" value="create">
            <input type="submit" name="publish" value="publish">
            <a href="{{ path('Main') }}"><button type="button" class="btn">Annuler</button></a>
            <a href="/lieu/add"> Ajouter un lieu </a>
        </div>
        <br>
        <br>

        {{ form_end(sortieForm) }}
        
        <br>
        <br>
    </div>

    <script>
        const inputLieu = document.querySelector('.lieuInput');
        inputLieu.addEventListener("change", function(event) {
            var requete = new XMLHttpRequest();

            document.querySelector('#rue').innerHTML = "";
            document.querySelector('#codePostal').innerHTML = "";
            document.querySelector('#longitude').innerHTML = "";
            document.querySelector('#latitude').innerHTML = "";

            requete.onload = function() {
            //La variable à passer est alors contenue dans l'objet response et l'attribut responseText.
                var lieu = JSON.parse(this.responseText);

                document.querySelector('#rue').innerHTML = lieu.rue;
                document.querySelector('#codePostal').innerHTML = lieu.codePostal;
                document.querySelector('#longitude').innerHTML = lieu.longitude;
                document.querySelector('#latitude').innerHTML = lieu.latitude;
            };
            const inputLieu = document.querySelector('.lieuInput');
            requete.open("GET", "lieu/" + inputLieu.value, true);
            requete.send();
        });
    </script>

{% endblock %}

